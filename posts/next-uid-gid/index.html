<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>Find the next available UID/GID &middot; Kevin Guay</title>

  <meta name="description" content="Find the next available uid/gid on a UNIX system" />

  

<meta itemprop="name" content="Find the next available UID/GID">
<meta itemprop="description" content="Find the next available uid/gid on a UNIX system"><meta itemprop="datePublished" content="2018-06-01T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-06-01T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="398">
<meta itemprop="keywords" content="Linux,Admin," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Find the next available UID/GID"/>
<meta name="twitter:description" content="Find the next available uid/gid on a UNIX system"/>


<meta property="og:title" content="Find the next available UID/GID" />
<meta property="og:description" content="Find the next available uid/gid on a UNIX system" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.kevinguay.com/posts/next-uid-gid/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-01T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2018-06-01T00:00:00&#43;00:00" />




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type":"Person",
      "@id": "https://www.kevinguay.com/#author",
      "name": "Kevin Guay",
      "image": {
        "@type":"ImageObject",
        
        "url": "https://www.kevinguay.com/images/profile.png"
        
      },
      "description": "tech / dev / security"
    },
    {
      "@type": "WebSite",
      "@id": "https://www.kevinguay.com/#website",
      "url": "https://www.kevinguay.com/",
      "name": "Kevin Guay",
      "description": "tech / dev / security",
      "publisher": {
        "@id": "https://www.kevinguay.com/#author"
      },
      "inLanguage": "en-us"
    },
    {
      "@type": "WebPage",
      "@id": "https://www.kevinguay.com/posts/next-uid-gid/#webpage",
      "url": "https://www.kevinguay.com/posts/next-uid-gid/",
      "name": "Find the next available UID/GID",
      "isPartOf": {
        "@id": "https://www.kevinguay.com/#website"
      },
      "about": {
         "@id": "https://www.kevinguay.com/#author"
      },
      "datePublished": "2018-06-01T00:00:00+00:00",
      "dateModified": "2018-06-01T00:00:00+00:00",
      "description": "Find the next available uid/gid on a UNIX system",
      "inLanguage": "en-us",
      "potentialAction": [
        {
          "@type": "ReadAction",
          "target": [
            "https://www.kevinguay.com/posts/next-uid-gid/"
          ]
        }
      ]
    },
    {
      "@type": "Article",
      "isPartOf": {
        "@id": "https://www.kevinguay.com/posts/next-uid-gid/#webpage"
      },
      "mainEntityOfPage": {
        "@id": "https://www.kevinguay.com/posts/next-uid-gid/#webpage"
      },
      "headline": "Find the next available UID/GID",
      "datePublished": "2018-06-01T00:00:00+00:00",
      "dateModified": "2018-06-01T00:00:00+00:00",
      "publisher": {
        "@id": "https://www.kevinguay.com/#author"
      },
      "keywords": [
        "Linux",
        "Admin"
      ],
      "articleSection": [
      ],
      "inLanguage": "en-us",
      "author": {
        "@type": "Person",
        "name":  null 
      },
      "potentialAction": [
        {
          "@type": "CommentAction",
          "name": "Comment",
          "target": [
            "https://www.kevinguay.com/posts/next-uid-gid/#comments"
          ]
        }
      ]
    }
  ]
}
</script>




  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  
<style type="text/css">
  .sidebar {
    background-color: #3563A0;
  }

  .read-more-link a {
    border-color: #3563A0;
  }

  .read-more-link a:hover {
    background-color: #3563A0;
  }

  .pagination li a {
    color: #3563A0;
    border: 1px solid #3563A0;
  }

  .pagination li.active a {
    background-color: #3563A0;
  }

  .pagination li a:hover {
    background-color: #3563A0;
    opacity: 0.75;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #3563A0;
  }
</style>



  <link type="text/css" rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109988049-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-109988049-1');
  </script>
    
</head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <a href="https://www.kevinguay.com/">
            <img src="/images/profile.png" class="img-circle img-headshot center" alt="Profile Picture">
          </a>
        </div>
        
      

      <h1><a href="/posts/next-uid-gid/">Kevin Guay</a></h1>

      
      <p class="lead">tech / dev / security</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://www.kevinguay.com/">Home</a>
        </li>
        <li>
          <a href="/posts/">Posts</a>
        </li><li>
          <a href="/tags/">Tags</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/consulting/">Consulting</a>
        </li><li>
          <a href="/resume/">Resume</a>
        </li>
      </ul>
    </nav>
    
    hello@kevinguay.com
    
    <section class="social-icons">
      
      <a href="https://www.linkedin.com/in/kevincguay/" rel="me" title="Linkedin" target="_blank">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/kguay" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/kevincguay" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
      <a href="https://instagram.com/kevin.c.guay" rel="me" title="Instagram" target="_blank">
        <i class="fab fa-instagram" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1 class="title">Find the next available UID/GID</h1>
  

  <div class="post-date">
    <time datetime="2018-06-01T00:00:00Z">Jun 1, 2018</time> <span class="readtime">&middot; 2 min read</span>
  </div>

  
<div>
  <ul class="tags">
  <li>
    <a href="https://www.kevinguay.com/tags/linux/" class="tag-link">Linux</a>
  </li>
  
  <li>
    <a href="https://www.kevinguay.com/tags/admin/" class="tag-link">Admin</a>
  </li>
  </ul>
</div>



  <div>
  <h2 id="new-user-accounts">New User Accounts</h2>
<p>If you manage multiple linux servers, you know that creating users can be quite a process, especially when mounting/unmounting home directories and setting up permissions is involved. I am in the process of automating user creation with Ansible, but there is a road block that has been holding me back. Because we share home directories across systems, the user&rsquo;s uid and gid need to be the same on all of the servers in our environment (especially our hpc environment).</p>
<p>In order to automatically creat accounts, I need to be able to quickly find the next available uid/gid in a particular range (in this case the 3000&rsquo;s; 3000-3999).</p>
<h2 id="finding-the-next-available-uid-andor-gid">Finding the next available UID and/or GID</h2>
<p>To get started, I dump the user and group files to stdout. This provides all of the uid&rsquo;s (/etc/passwd) and gid&rsquo;s(/etc/group):</p>
<pre><code>cat /etc/group /etc/passwd
</code></pre><p>Next, I pipe that output to the cut command which strips off everything except the uid (for /etc/passwd) and gid (for /etc/group):</p>
<pre><code>cat /etc/group /etc/passwd | cut -d &quot;:&quot; -f 3
</code></pre><p>I then search for all numbers that are in the range 3000-3999 using a regular expression, <code>^3...$</code>. The <code>^</code> marks the start of the number so that it doesn&rsquo;t include (123000). The <code>.</code>&rsquo;s are wildcards and the <code>$</code> marks the end of the term.</p>
<pre><code>cat /etc/group /etc/passwd | cut -d &quot;:&quot; -f 3 | grep &quot;^3...$&quot;
</code></pre><p>Now that we have all the numbers in our range, we need to find the highest value. To do that, I sort the list from low to high using <code>sort</code> and use tail -n 1 to get the last element (highest number).</p>
<pre><code>cat /etc/group /etc/passwd | cut -d &quot;:&quot; -f 3 | grep &quot;^3...$&quot; | sort -n | tail -n 1
</code></pre><p>So we now have the largest uid and/or gid in our range. Since I like the uid to be the same as the gid, I don&rsquo;t care if I skip a gid or uid in this process, as long as it is not going to conflict with any existing id&rsquo;s.</p>
<p>Lastely we need to increment the number by one. Like other things in linux, this is more difficult than it seems, but nonetheless we have the next uid and gid ready for user creation:</p>
<pre><code>cat /etc/group /etc/passwd | cut -d &quot;:&quot; -f 3 | grep &quot;^3...$&quot; | sort -n | tail -n 1 | awk '{ print $1+1 }'
</code></pre>
  </div>

  <hr>
  
  
    Previous: <a href="/posts/hugo-html-in-content/">Hugo: HTML code in content files</a>
  
  <br>
  
    Next: <a href="/posts/continuous-integration-and-content-management/">Easy static website editing using TravisCI and Forestry.io</a>
  
  
  <div class="share-buttons">
  <a class="twitter-share-button"
     href="#"
     title="Share on Twitter"
     data-url="https://www.kevinguay.com/posts/next-uid-gid/"
     data-text="Find the next available UID/GID"><i class="fab fa-twitter"></i></a>

  <a class="linkedin-share-button"
     href="#"
     title="Share on LinkedIn"
     data-url="https://www.kevinguay.com/posts/next-uid-gid/"
     data-text="Find the next available UID/GID"><i class="fab fa-linkedin-in"></i></a>

  <a class="facebook-share-button"
     href="#"
     title="Share on Facebook"
     data-url="https://www.kevinguay.com/posts/next-uid-gid/"
     data-text="Find the next available UID/GID"><i class="fab fa-facebook"></i></a>

  <a class="telegram-share-button"
     href="#"
     title="Share on Telegram"
     data-url="https://www.kevinguay.com/posts/next-uid-gid/"
     data-text="Find the next available UID/GID"><i class="fab fa-telegram"></i></a>

  <a class="pinterest-share-button"
     href="#"
     title="Share on Pinterest"
     data-url="https://www.kevinguay.com/posts/next-uid-gid/"
     data-text="Find the next available UID/GID"><i class="fab fa-pinterest"></i></a>
</div>


  
  

  
</div>
  </main>

  <footer>
  <div>
    <p>
      &copy; Kevin Guay 2021

      &middot; <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">CC BY-SA 4.0</a>

      
    </p>
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>


  <script src="/js/jquery.min.js"></script>
  <script src="/js/soho.js"></script>

  <script src="/js/blog.js"></script>

  
</body>
</html>
